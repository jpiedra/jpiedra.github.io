<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jonathan Piedra</title>
    <link>http://jpiedra.github.io/tags/linux/index.xml</link>
    <description>Recent content on Jonathan Piedra</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://jpiedra.github.io/tags/linux/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>A simple build script, with minor improvements</title>
      <link>http://jpiedra.github.io/article/simple-build-script/</link>
      <pubDate>Wed, 01 Feb 2017 10:51:38 -0500</pubDate>
      
      <guid>http://jpiedra.github.io/article/simple-build-script/</guid>
      <description>&lt;p&gt;Today we go over the process of writing a very simple Bash script. We&amp;rsquo;ll be able to detect whether a build for a &lt;a href=&#34;https://gohugo.io/overview/quickstart/&#34;&gt;Hugo static site&lt;/a&gt; is present, push the files to a Git repository for our website, and automate all the steps involved.&lt;/p&gt;

&lt;p&gt;
&lt;h2&gt;Version 1&lt;/h2&gt;&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;ll begin by showing the code, then explain my process:&lt;/p&gt;

&lt;pre&gt;
#!/bin/bash

build_dir=/var/www/html/blog-dev/public
deploy_dir=/var/www/html/blog-live/jpiedra.github.io

if [ -d $build_dir ]
then
  echo &#34;BUILD FOUND, DETAILS:&#34;
  echo $(stat $build_dir)
  cd $deploy_dir &amp;&amp; rm -rf *
  cp -rp $build_dir/* $deploy_dir
  cd $deploy_dir &amp;&amp; git status; git add -A; git commit -m &#34;[Scripted Deploy $(date)]&#34;; git push
else
  echo &#34;NO BUILD FOUND&#34;
  echo &#34;  Run &#39;hugo&#39; to &#34;
  echo &#34;  create latest build&#34;
fi
&lt;/pre&gt;

&lt;p&gt;We begin by setting two variables, &lt;b&gt;build_dir&lt;/b&gt; and &lt;b&gt;deploy_dir.&lt;/b&gt; These store string values indicating the locations of where our built Hugo site&amp;rsquo;s files reside, and the directory where those files should be copied to, respectively. In this case, &lt;b&gt;deploy_dir&lt;/b&gt; is a GitHub Pages repository, the files used therein are the same ones responsible for powering this website!&lt;/p&gt;

&lt;h2&gt;Testing for Build Directory&lt;/h2&gt;

&lt;p&gt;The bulk of this script begins where the &lt;i&gt;if.. ..fi&lt;/i&gt; structure is shown. This conditional structure begins with a &lt;a href=&#34;http://linuxcommand.org/lc3_man_pages/testh.html&#34;&gt;test.&lt;/a&gt; Now, because we&amp;rsquo;re writing a Bash script, rather than using the command line, we have a built-in operator available to us, the square brackets [ ]. These are used to perform any test in a Bash script, thus instead of writing &lt;i&gt;test -d /some/directory&lt;/i&gt; we can instead write &lt;i&gt;[ -d /some/directory ]&lt;/i&gt;.&lt;/p&gt;

&lt;p&gt;The -d switch allows us to test whether the provided argument is a directory. The test returns 0 or 1, true and false respectively, depending on whether the provided argument is detected as a valid directory. In this script, we test the value stored in &lt;b&gt;$build_dir&lt;/b&gt; (thus, the dollar sign) to check whether a build folder exists in our Hugo site directory - which, by default, would be called &lt;i&gt;public&lt;/i&gt; and reside in the Hugo site base directory.&lt;/p&gt;

&lt;p&gt;&lt;i&gt;Tip: you can run the command &lt;b&gt;compgen -b&lt;/b&gt; with the provided -b switch to get a list of all Bash built-ins available to you. Running the command in your terminal, displays the [ ] built-in near the top of the list.&lt;/i&gt;&lt;/p&gt;

&lt;h2&gt;Conditional Execution&lt;/h2&gt;

&lt;p&gt;In the event our test for a directory fails (directory doesn&amp;rsquo;t exist), we simply echo out a diagnostic message (which would best be output to standard error, more on that later). After &lt;i&gt;else&lt;/i&gt; our script prints the messages to stdout, so whatever is echo&amp;rsquo;ed is visible in the terminal.&lt;/p&gt;

&lt;p&gt;If the build directory does exist, we can begin performing the required steps to push our files to the GitHub pages directory, indicated by &lt;b&gt;$deploy_dir.&lt;/b&gt; We&amp;rsquo;ll be making repeated use of a central Bash feature here.&lt;/p&gt;

&lt;h2&gt;Command Substitution&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://tldp.org/LDP/abs/html/commandsub.html&#34;&gt;Command substitution&lt;/a&gt; &amp;ldquo;literally plugs&amp;hellip; command output into another context,&amp;rdquo; as the aforementioned page phrases it. Indeed, by using certain operators built into the Bash language, we can get the output of a command and do with it whatever we want - this usually means assinging said output to a variable, parsing it using some other commands, or even saving it to another file.&lt;/p&gt;

&lt;p&gt;We&amp;rsquo;ll use command substitution twice here, as indicated by &lt;i&gt;$(&amp;hellip;)&lt;/i&gt; where the elipses would be replaced by Bash built-ins or Linux commands. Another form that&amp;rsquo;s available to us uses backticks, but we&amp;rsquo;ll stick with the former operator instead.&lt;/p&gt;

&lt;h2&gt;Deployment Process&lt;/h2&gt;

&lt;p&gt;After echo&amp;rsquo;ing that we&amp;rsquo;ve found the build folder, we run a few commands when the build directory is detected.&lt;/p&gt;

&lt;ol&gt;
    &lt;li&gt;Command substitution is used to capture the output of running &lt;i&gt;stat $build_dir&lt;/i&gt;, thus printing the result of that command to stdout using echo&lt;/li&gt;
    &lt;li&gt;We change into the deployment directory, and remove the files present there, making way for the files from our latest Hugo site build &lt;i&gt;(cd $deploy_dir &amp;&amp; rm -rf *)&lt;/i&gt;&lt;/li&gt;
    &lt;li&gt;The contents of the Hugo site build directory are copied into the deployment directory &lt;i&gt;(cp -rp $build_dir/* $deploy_dir)&lt;/i&gt;&lt;/li&gt;
    &lt;li&gt;Finally, we change into the deployment directory and execute a few standard Git commands, that add/commit/push the new files to the current branch&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;A few notes on step 4. The &lt;i&gt;&amp;amp;&amp;amp;&lt;/i&gt; operator ensures that the second command, &lt;i&gt;git status&lt;/i&gt; is only executed if &lt;i&gt;cd&lt;/i&gt; is successful. This is seen elsewhere, in step 2, ensuring we remove the files only if we successfully changed to the desired folder. Also in step 4, we see the final example of command substitution used when we indicate a message for &lt;i&gt;git commit&lt;/i&gt; to use. We capture the output of running the Bash built-in &lt;i&gt;time&lt;/i&gt; and use that as part of the content for our commit message.&lt;/p&gt;

&lt;p&gt;When you run this script, the last part of this deployment process would involve running &lt;i&gt;git push,&lt;/i&gt; so you would be expected to provide your credentials in the terminal to push the latest Hugo site files. In summation, having a script such as this can save precious time, by performing various checks for us along the way as well as eliminating the tedium of typing and executing several commands.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Installing squarespace-server on Ubuntu 14.04 LTS</title>
      <link>http://jpiedra.github.io/article/squarespace-server-ubuntu/</link>
      <pubDate>Mon, 30 Jan 2017 18:11:31 -0500</pubDate>
      
      <guid>http://jpiedra.github.io/article/squarespace-server-ubuntu/</guid>
      <description>&lt;p&gt;This article details how to install the &lt;a href=&#34;http://developers.squarespace.com/local-development/&#34;&gt;Squarespace local development server&lt;/a&gt; on Ubuntu 14.04 LTS.&lt;/p&gt;

&lt;p&gt;I recently took on a small project, some work on customizing Squarespace templates. In the course of doing this, I required the Squarespace local development server in order to quickly modify and test changes to the template. I use a VirtualBox VM I built some time ago using Vagrant, based on Ubuntu 14.04 LTS.&lt;/p&gt;

&lt;p&gt;If you&amp;rsquo;ve encountered problems installing this program on the aforemention Linux distro, read on and follow these steps, as they ended up working for me very well!&lt;/p&gt;

&lt;p&gt;
&lt;h2&gt;Potential Errors&lt;/h2&gt;&lt;/p&gt;

&lt;p&gt;After following the instructions on Squarespace&amp;rsquo;s official website (link above) you might have come across the following error:&lt;/p&gt;

&lt;pre&gt;
$ npm install -g @squarespace/server
@squarespace/server@1.0.7 copyrunscript /usr/lib/node_modules/.staging/@squarespace/server-b43b0a9f
node scripts/copyfile.js build/distributions/local-developer/bin/run.bat darwin:build/distributions/local-developer/bin/osx-local-developer win32:build/distributions/local-developer/bin/win-local-developer.bat linux:build/distributions/local-developer/bin/linux-local-developer build/distributions/local-developer/bin/local-developer

copying build/distributions/local-developer/bin/linux-local-developer to build/distributions/local-developer/bin/run.bat
npm ERR! Linux 4.2.0-27-generic
npm ERR! argv &#34;/usr/bin/nodejs&#34; &#34;/usr/bin/npm&#34; &#34;install&#34; &#34;-g&#34; &#34;@squarespace/server&#34;
npm ERR! node v6.9.4
npm ERR! npm  v3.10.10
npm ERR! path ../lib/node_modules/@squarespace/server/build/distributions/local-developer/bin/run.bat
npm ERR! code EACCES
npm ERR! errno -13
npm ERR! syscall symlink

npm ERR! Error: EACCES: permission denied, symlink &#39;../lib/node_modules/@squarespace/server/build/distributions/local-developer/bin/run.bat&#39; -&gt; &#39;/usr/bin/squarespace-server&#39;
npm ERR!     at Error (native)
npm ERR!  { Error: EACCES: permission denied, symlink &#39;../lib/node_modules/@squarespace/server/build/distributions/local-developer/bin/run.bat&#39; -&gt; &#39;/usr/bin/squarespace-server&#39;
npm ERR!     at Error (native)
npm ERR!   errno: -13,
npm ERR!   code: &#39;EACCES&#39;,
npm ERR!   syscall: &#39;symlink&#39;,
npm ERR!   path: &#39;../lib/node_modules/@squarespace/server/build/distributions/local-developer/bin/run.bat&#39;,
npm ERR!   dest: &#39;/usr/bin/squarespace-server&#39; }
npm ERR! 
&lt;/pre&gt;

&lt;p&gt;This may occur if you attempt to install the program as a &lt;i&gt;user with insufficient permissions.&lt;/i&gt; Installing as root may resolve the problem, as well as &lt;a href=&#34;https://docs.npmjs.com/getting-started/fixing-npm-permissions&#34;&gt;providing the user NPM is running under with the required permissions.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However, even following that step might not end matters for you; the next error might come up:&lt;/p&gt;

&lt;pre&gt;
$ sudo npm install -g @squarespace/server
npm WARN lifecycle @squarespace/server@1.0.7~preinstall: cannot run in wd %s %s (wd=%s) @squarespace/server@1.0.7 npm run accept &amp;&amp; node scripts/execif.js --exists=build npm run copyrunscript /usr/lib/node_modules/.staging/@squarespace/server-b43b0a9f
npm ERR! Linux 4.2.0-27-generic
npm ERR! argv &#34;/usr/bin/nodejs&#34; &#34;/usr/bin/npm&#34; &#34;install&#34; &#34;-g&#34; &#34;@squarespace/server&#34;
npm ERR! node v6.9.4
npm ERR! npm  v3.10.10
npm ERR! path /usr/lib/node_modules/@squarespace/server/build/distributions/local-developer/bin/run.bat
npm ERR! code ENOENT
npm ERR! errno -2
npm ERR! syscall chmod

npm ERR! enoent ENOENT: no such file or directory, chmod &#39;/usr/lib/node_modules/@squarespace/server/build/distributions/local-developer/bin/run.bat&#39;
npm ERR! enoent ENOENT: no such file or directory, chmod &#39;/usr/lib/node_modules/@squarespace/server/build/distributions/local-developer/bin/run.bat&#39;
npm ERR! enoent This is most likely not a problem with npm itself
npm ERR! enoent and is related to npm not being able to find a file.
npm ERR! enoent 
&lt;/pre&gt;

&lt;p&gt;The error messages may seem a bit opaque, but it appears that a required folder either wasn&amp;rsquo;t created or found during the installation process.&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;A workaround: install &amp;ldquo;locally,&amp;rdquo; then globally&lt;/h2&gt;
I ended up having to rely on a workaround. When I say &amp;ldquo;locally&amp;rdquo; I really mean, first installing the squarespace-server dependency for a specific node project, then &lt;i&gt;moving that installation&lt;/i&gt; over to the location it must reside at in order to be used globally.&lt;/p&gt;

&lt;p&gt;Installing squarespace-server for a specific project is easy enough, just omit the global flag (-g) when you install it to your site template&amp;rsquo;s project directory. The part that might be tricky for some is &amp;ldquo;moving&amp;rdquo; the files over, as it involves not only moving the files over to a new directory, but applying permissions and creating a symbolic link as well. The presence of the symbolic link is what will allow us to launch squarespace-server globally. The steps are as follows:
&lt;ol&gt;
    &lt;li&gt;Clone the files for your Squarespace site, as instructed here: &lt;a href=&#34;http://developers.squarespace.com/local-development&#34;&gt;http://developers.squarespace.com/local-development&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;Change into the &amp;lsquo;template&amp;rsquo; directory created after cloning&lt;/li&gt;
    &lt;li&gt;Install the squarespace-server package normally (not globally)
    &lt;pre&gt;$ npm install @squarespace/server&lt;/pre&gt;
    &lt;/li&gt;
    &lt;li&gt;You should now have a directory:&lt;b&gt;template/node_modules/@squarespace&lt;/b&gt;
    &lt;/li&gt;
    &lt;li&gt;Copy the files for this module into your system-wide &amp;lsquo;node_modules&amp;rsquo; directory:
    &lt;pre&gt;$ sudo cp -rp node_modules/@squarespace /usr/lib/node_modules/&lt;/pre&gt;
    &lt;/li&gt;
    &lt;li&gt;Change the permissions for this copied folder as needed. This location will vary depending on your operating system (for our purposes, we&amp;rsquo;re using a Vagrant Box based on Ubuntu 14.04, thus the user shown below:
    &lt;pre&gt;$ sudo chown -R vagrant:root @squarespace
$ sudo chmod -R 755 @squarespace&lt;/pre&gt;
    &lt;/li&gt;
    &lt;li&gt;Finally, create a symbolic link, allowing us to run &amp;lsquo;squarespace-server&amp;rsquo; from anywhere:&lt;pre&gt;$ sudo ln -s /usr/lib/node_modules/@squarespace/server/build/distributions/local-developer/bin/run.bat /usr/bin/squarespace-server&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;/p&gt;

&lt;p&gt;You should now be able to use the local development server, from inside your site&amp;rsquo;s &amp;lsquo;template&amp;rsquo; directory:
&lt;pre&gt;$ squarespace-server https://[sitename].squarespace.com &amp;ndash;auth&lt;/pre&gt;&lt;/p&gt;

&lt;p&gt;Hopefully this solution works for you. Share in the comments if this helped you get squarespace-server running!&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>