<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>
    	
  	Never Update an AWS Security Group Again &ndash; Jonathan Piedra

    </title>
	
<link type="text/css" rel="stylesheet" href="/css/style.css">
<link type="text/css" rel="stylesheet" href="/css/blogpanel.css">
<link type="text/css" rel="stylesheet" href="/css/projectpanel.css">
<link type="text/css" rel="stylesheet" href="/css/resp.css">
<script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito|Roboto|Montserrat">
</head>
<body>
	<ul class="navbar">
	<div class="navbar-left">
		<li class="navbar_brand">
			<a href="http://jpiedra.github.io">Jonathan Piedra</a>
		</li>
	</div>
	<div class="navbar-right">
		<li>
			<a href="http://jpiedra.github.io/article">Articles</a>
		</li>
		<li>
			<a href="http://jpiedra.github.io/project">Projects</a>
		</li>
		<li>
			<a href="mailto:jpiedra1990@gmail.com">Contact</a>
		</li>
	</div>
</ul>
	<div class="col-main">
		
	<div class="blogpanel blogpanel_single">
		<div class="blogpanel_head">
			<div class="blogpanel_head-date">
				<h1>July 8 2018</h1>
			</div>
			<div class="blogpanel_head-title">
				<h1>Never Update an AWS Security Group Again</h1>
			</div>
		</div>
		<div class="blogpanel_body">
			<p><p>Sweat the small stuff! Script that itch you can&rsquo;t scratch&hellip;</p>
<!-- raw HTML omitted -->
<p>In the case of Amazon Web Services, access to Elastic Cloud Compute (EC2) instances is controlled through the configuration of <!-- raw HTML omitted -->security groups.<!-- raw HTML omitted --> You configure a security group with one or more ingress and egress traffic rules, indicating what traffic is allowed over which ports, from which IP addresses or subnets. Those security groups are applied to EC2 instances, and that&rsquo;s how traffic to, from, or between you, those instances, and other AWS resources gets defined.</p>
<p>You can set up a security group initially to allow access - say, over port 22 for SSH sessions - from your home device. At the moment, AWS will conveniently determine your device&rsquo;s external IP address, and set up the access you desire.</p>
<p>This helps in the near-term, but needs to be updated as soon as your internet service provider (ISP) changes your IP address. While spending all of 5-10 minutes accessing your AWS console to manually update security groups may not sound so bad, it would be nice if an automated solution to that problem was possible.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>The former outlines the start of a script that accepts a single parameter, the <!-- raw HTML omitted -->group id<!-- raw HTML omitted --> for the security group you&rsquo;d like to update regularly. For our purposes, we would work with whatever security group was configured already, using the home IP address at the time it was configured, and pass the group ID of that security group into our script. Let&rsquo;s work with a security group with ID <!-- raw HTML omitted -->sg-6d3c3c26<!-- raw HTML omitted --> that configures SSH access from <!-- raw HTML omitted -->1.2.3.4<!-- raw HTML omitted -->.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>This ensures that, even if a security group ID for a group that does not define traffic over port 22 is passed in, no action will be taken, as the call to AWS will fail to find a security group matching the criteria defined in the <!-- raw HTML omitted -->Filters<!-- raw HTML omitted --> argument.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>At this point, we have two tasks left. Rather than update the existing ingress traffic rule in place, it&rsquo;s easier to just revoke that ingress traffic and then add a new rule later, with the same from- and to-port, protocol, and our updated IP address. We&rsquo;re thinking ahead here, and storing the object representing the current ingress rule from our response in a variable <!-- raw HTML omitted -->old_access<!-- raw HTML omitted -->. We&rsquo;ll use that object in a call soon to remove access over port 22 from our old IP address.</p>
<p>Here&rsquo;s the code we&rsquo;ll use to determine our new external IP address, revoke access over port 22 from our old IP address, and authorize access over port 22 with the new one:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>All told, our script can find the security group we defined, and update it with our current external IP address. Note the first octet of the <!-- raw HTML omitted -->Source IP<!-- raw HTML omitted --> address updating:</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>The final version of this script can be found here:</p>
<!-- raw HTML omitted --></p>
			<a class="blogpanel_body-more" href="http://jpiedra.github.io">Return home</a>
		</div>
		
		<div class="blogpanel_foot">
			<div class="blogpanel_foot">
				<div class="blogpanel_foot-tag-name">
					<p>Tags:</p>
				</div>
				<div class="blogpanel_foot-tag-list">
					<ul>
						
							<li>
								<a href="/tags/scripting">scripting</a>
							</li>
						
							<li>
								<a href="/tags/aws">aws</a>
							</li>
						
							<li>
								<a href="/tags/python">python</a>
							</li>
						
							<li>
								<a href="/tags/ec2">ec2</a>
							</li>
						
					</ul>
				</div>
			</div>	
		</div>
		
	</div>
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jpiedra" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

		<div class="col-main_pages" >
			
			
		</div>
	</div>
	<div class="col-side">
		
			<div class="blogpanel">
	<div class="blogpanel_head">
		<div class="blogpanel_head-title">
			<h1>Tags</h1>
		</div>
	</div>
	<div class="blogpanel_body">
		<div class="blogpanel_foot-tag-list">
			<ul>
				
				
				
				
					<li>
						<a href="/tags/api">api</a>
					</li>
				
					<li>
						<a href="/tags/aws">aws</a>
					</li>
				
					<li>
						<a href="/tags/bash">bash</a>
					</li>
				
					<li>
						<a href="/tags/constructor">constructor</a>
					</li>
				
					<li>
						<a href="/tags/css">css</a>
					</li>
				
					<li>
						<a href="/tags/design">design</a>
					</li>
				
					<li>
						<a href="/tags/development">development</a>
					</li>
				
					<li>
						<a href="/tags/ec2">ec2</a>
					</li>
				
					<li>
						<a href="/tags/es5">es5</a>
					</li>
				
					<li>
						<a href="/tags/git">git</a>
					</li>
				
					<li>
						<a href="/tags/javascript">javascript</a>
					</li>
				
					<li>
						<a href="/tags/linux">linux</a>
					</li>
				
					<li>
						<a href="/tags/module">module</a>
					</li>
				
					<li>
						<a href="/tags/mysql">mysql</a>
					</li>
				
					<li>
						<a href="/tags/nodejs">nodejs</a>
					</li>
				
					<li>
						<a href="/tags/part-1">part-1</a>
					</li>
				
					<li>
						<a href="/tags/part-2">part-2</a>
					</li>
				
					<li>
						<a href="/tags/php">php</a>
					</li>
				
					<li>
						<a href="/tags/powershell">powershell</a>
					</li>
				
					<li>
						<a href="/tags/python">python</a>
					</li>
				
					<li>
						<a href="/tags/s3">s3</a>
					</li>
				
					<li>
						<a href="/tags/scripting">scripting</a>
					</li>
				
					<li>
						<a href="/tags/squarespace">squarespace</a>
					</li>
				
					<li>
						<a href="/tags/tips">tips</a>
					</li>
				
					<li>
						<a href="/tags/troubleshooting">troubleshooting</a>
					</li>
				
					<li>
						<a href="/tags/virtualbox">virtualbox</a>
					</li>
				
					<li>
						<a href="/tags/virtualization">virtualization</a>
					</li>
				
					<li>
						<a href="/tags/webdev">webdev</a>
					</li>
				
			</ul>
		</div>
	</div>
</div>
			<div class="blogpanel">
	<div class="blogpanel_head">
		<div class="blogpanel_head-title">
			<h1>Recent Posts</h1>
		</div>
	</div>
	<div class="blogpanel_body">
		<div class="blogpanel_foot-post-list">
			<ol>
				
				
					<li>
						<a href="http://jpiedra.github.io/article/">
							Articles - Posted Jul 26 2018
						</a>
					</li>
				
					<li>
						<a href="http://jpiedra.github.io/tags/javascript/">
							javascript - Posted Jul 26 2018
						</a>
					</li>
				
					<li>
						<a href="http://jpiedra.github.io/">
							Jonathan Piedra - Posted Jul 26 2018
						</a>
					</li>
				
					<li>
						<a href="http://jpiedra.github.io/tags/mysql/">
							mysql - Posted Jul 26 2018
						</a>
					</li>
				
					<li>
						<a href="http://jpiedra.github.io/article/mysql-connector-node/">
							Node.js Connector to a MySQL Database - Posted Jul 26 2018
						</a>
					</li>
				
					<li>
						<a href="http://jpiedra.github.io/tags/nodejs/">
							nodejs - Posted Jul 26 2018
						</a>
					</li>
				
					<li>
						<a href="http://jpiedra.github.io/tags/">
							Tags - Posted Jul 26 2018
						</a>
					</li>
				
					<li>
						<a href="http://jpiedra.github.io/tags/aws/">
							aws - Posted Jul 8 2018
						</a>
					</li>
				
					<li>
						<a href="http://jpiedra.github.io/tags/ec2/">
							ec2 - Posted Jul 8 2018
						</a>
					</li>
				
					<li>
						<a href="http://jpiedra.github.io/article/never-update-security-group/">
							Never Update an AWS Security Group Again - Posted Jul 8 2018
						</a>
					</li>
				
			</ol>
		</div>
	</div>
</div>
		
	</div>
</body>
</html>